local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")
local Workspace = game:GetService("Workspace")
local Camera = Workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer

if CoreGui:FindFirstChild("QUWY_STEEL_TITANS") then CoreGui.QUWY_STEEL_TITANS:Destroy() end
if CoreGui:FindFirstChild("QUWY_ESP_CONTAINER") then CoreGui.QUWY_ESP_CONTAINER:Destroy() end
RunService:UnbindFromRenderStep("QUWY_AIM_LOCK")

local Theme = {
    Background = Color3.fromRGB(12, 12, 12),
    Element = Color3.fromRGB(20, 20, 20),
    Accent = Color3.fromRGB(150, 80, 255),
    Text = Color3.fromRGB(240, 240, 240),
    SubText = Color3.fromRGB(120, 120, 120),
    Red = Color3.fromRGB(255, 50, 50),
    Green = Color3.fromRGB(50, 255, 100),
    Ammo = Color3.fromRGB(180, 0, 255),
    Engine = Color3.fromRGB(0, 200, 255),
    Locked = Color3.fromRGB(255, 0, 0)
}

local State = {
    ESP_Tanks = false,
    ESP_WeakSpots = false,
    Aimbot = false,
    AimMode = "Smart",
    Smoothness = 0.9, -- ЖЕСТКАЯ ФИКСАЦИЯ
    FOV = 220,
    Offset = Vector3.new(0, 0.4, 0)
}

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "QUWY_STEEL_TITANS"
ScreenGui.Parent = CoreGui
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

local NotifContainer = Instance.new("Frame"); NotifContainer.Parent = ScreenGui; NotifContainer.BackgroundTransparency = 1; NotifContainer.Position = UDim2.new(0.5, -100, 0.9, 0); NotifContainer.Size = UDim2.new(0, 200, 0, 40); NotifContainer.ZIndex = 200

local function Notify(text)
    local F = Instance.new("Frame"); F.Parent = NotifContainer; F.BackgroundColor3 = Theme.Element; F.Size = UDim2.new(0, 0, 0, 30); F.Position = UDim2.new(0.5, 0, 0, 0); F.AnchorPoint = Vector2.new(0.5, 0); F.BorderSizePixel = 0
    local C = Instance.new("UICorner", F); C.CornerRadius = UDim.new(0, 6); local S = Instance.new("UIStroke", F); S.Color = Theme.Accent; S.Thickness = 1
    local L = Instance.new("TextLabel", F); L.BackgroundTransparency = 1; L.Size = UDim2.new(1, 0, 1, 0); L.Font = Enum.Font.GothamMedium; L.Text = text; L.TextColor3 = Theme.Text; L.TextSize = 12; L.TextTransparency = 1
    TweenService:Create(F, TweenInfo.new(0.3), {Size = UDim2.new(0, 180, 0, 30)}):Play(); wait(0.1); TweenService:Create(L, TweenInfo.new(0.2), {TextTransparency = 0}):Play()
    wait(2); TweenService:Create(L, TweenInfo.new(0.2), {TextTransparency = 1}):Play(); local out = TweenService:Create(F, TweenInfo.new(0.3), {Size = UDim2.new(0, 0, 0, 30)}); out:Play(); out.Completed:Wait(); F:Destroy()
end

local Main = Instance.new("Frame"); Main.Name = "Main"; Main.Parent = ScreenGui; Main.BackgroundColor3 = Theme.Background; Main.Position = UDim2.new(0.5, -240, 0.5, -160); Main.Size = UDim2.new(0, 480, 0, 320); Main.BorderSizePixel = 0
local MainCorner = Instance.new("UICorner", Main); MainCorner.CornerRadius = UDim.new(0, 8); local MainStroke = Instance.new("UIStroke", Main); MainStroke.Color = Theme.Element; MainStroke.Thickness = 1

local TopBar = Instance.new("Frame"); TopBar.Parent = Main; TopBar.BackgroundTransparency = 1; TopBar.Size = UDim2.new(1, 0, 0, 40)
local Title = Instance.new("TextLabel"); Title.Parent = TopBar; Title.BackgroundTransparency = 1; Title.Position = UDim2.new(0, 15, 0, 0); Title.Size = UDim2.new(0, 200, 1, 0); Title.Font = Enum.Font.GothamBold; Title.Text = "QUWY: STEEL TITANS"; Title.TextColor3 = Theme.Text; Title.TextSize = 16; Title.TextXAlignment = Enum.TextXAlignment.Left

local CloseBtn = Instance.new("TextButton"); CloseBtn.Parent = TopBar; CloseBtn.BackgroundTransparency = 1; CloseBtn.Position = UDim2.new(1, -30, 0, 0); CloseBtn.Size = UDim2.new(0, 30, 1, 0); CloseBtn.Font = Enum.Font.GothamMedium; CloseBtn.Text = "×"; CloseBtn.TextColor3 = Theme.SubText; CloseBtn.TextSize = 20
local MinBtn = Instance.new("TextButton"); MinBtn.Parent = TopBar; MinBtn.BackgroundTransparency = 1; MinBtn.Position = UDim2.new(1, -60, 0, 0); MinBtn.Size = UDim2.new(0, 30, 1, 0); MinBtn.Font = Enum.Font.GothamMedium; MinBtn.Text = "−"; MinBtn.TextColor3 = Theme.SubText; MinBtn.TextSize = 20

local Sidebar = Instance.new("Frame"); Sidebar.Parent = Main; Sidebar.BackgroundTransparency = 1; Sidebar.Position = UDim2.new(0, 0, 0, 40); Sidebar.Size = UDim2.new(0, 120, 1, -40)
local SideList = Instance.new("UIListLayout", Sidebar); SideList.HorizontalAlignment = Enum.HorizontalAlignment.Center; SideList.SortOrder = Enum.SortOrder.LayoutOrder; SideList.Padding = UDim.new(0, 5); local SidePad = Instance.new("UIPadding", Sidebar); SidePad.PaddingTop = UDim.new(0, 15)
local PageContainer = Instance.new("Frame"); PageContainer.Parent = Main; PageContainer.BackgroundTransparency = 1; PageContainer.Position = UDim2.new(0, 120, 0, 40); PageContainer.Size = UDim2.new(1, -120, 1, -40)

local function CreateTabBtn(text)
    local B = Instance.new("TextButton"); B.Parent = Sidebar; B.BackgroundColor3 = Theme.Background; B.Size = UDim2.new(0, 100, 0, 30); B.Font = Enum.Font.GothamMedium; B.Text = text; B.TextColor3 = Theme.SubText; B.TextSize = 13
    local C = Instance.new("UICorner", B); C.CornerRadius = UDim.new(0, 4)
    return B
end

local Tab1 = CreateTabBtn("Combat")
local Tab2 = CreateTabBtn("Visuals")
local Tab3 = CreateTabBtn("Info")
local Page1 = Instance.new("Frame", PageContainer); Page1.Size = UDim2.new(1,0,1,0); Page1.BackgroundTransparency = 1
local Page2 = Instance.new("Frame", PageContainer); Page2.Size = UDim2.new(1,0,1,0); Page2.BackgroundTransparency = 1; Page2.Visible = false
local Page3 = Instance.new("Frame", PageContainer); Page3.Size = UDim2.new(1,0,1,0); Page3.BackgroundTransparency = 1; Page3.Visible = false

local function SwitchTab(btn, page)
    for _, t in pairs({Tab1, Tab2, Tab3}) do t.TextColor3 = Theme.SubText; t.BackgroundColor3 = Theme.Background end
    for _, p in pairs({Page1, Page2, Page3}) do p.Visible = false end
    btn.TextColor3 = Theme.Accent; btn.BackgroundColor3 = Theme.Element; page.Visible = true
end
SwitchTab(Tab1, Page1)
Tab1.MouseButton1Click:Connect(function() SwitchTab(Tab1, Page1) end)
Tab2.MouseButton1Click:Connect(function() SwitchTab(Tab2, Page2) end)
Tab3.MouseButton1Click:Connect(function() SwitchTab(Tab3, Page3) end)

local function CreateButton(text, parent, x, y, callback)
    local B = Instance.new("TextButton"); B.Parent = parent; B.BackgroundColor3 = Theme.Element; B.Position = UDim2.new(0, x, 0, y); B.Size = UDim2.new(0, 165, 0, 35)
    B.Font = Enum.Font.GothamMedium; B.Text = text; B.TextColor3 = Theme.Text; B.TextSize = 12; B.AutoButtonColor = false
    local C = Instance.new("UICorner", B); C.CornerRadius = UDim.new(0, 4)
    local S = Instance.new("UIStroke", B); S.Color = Theme.Element; S.Thickness = 1
    local Toggled = false
    B.MouseButton1Click:Connect(function()
        Toggled = not Toggled
        if Toggled then
            TweenService:Create(B, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(25,25,25)}):Play()
            TweenService:Create(S, TweenInfo.new(0.2), {Color = Theme.Accent}):Play()
            TweenService:Create(B, TweenInfo.new(0.2), {TextColor3 = Theme.Accent}):Play()
        else
            TweenService:Create(B, TweenInfo.new(0.2), {BackgroundColor3 = Theme.Element}):Play()
            TweenService:Create(S, TweenInfo.new(0.2), {Color = Theme.Element}):Play()
            TweenService:Create(B, TweenInfo.new(0.2), {TextColor3 = Theme.Text}):Play()
        end
        callback(Toggled, B)
    end)
    return B
end

local function CreateLinkBtn(text, url, yPos)
    local Btn = Instance.new("TextButton", Page3); Btn.BackgroundColor3 = Theme.Element; Btn.Position = UDim2.new(0.5, -100, 0.55, yPos); Btn.Size = UDim2.new(0, 200, 0, 35)
    Btn.Font = Enum.Font.GothamBold; Btn.Text = text; Btn.TextColor3 = Theme.Text; Btn.TextSize = 13
    Instance.new("UICorner", Btn).CornerRadius = UDim.new(0, 20); Instance.new("UIStroke", Btn).Color = Theme.Accent; Instance.new("UIStroke", Btn).Thickness = 1
    Btn.MouseButton1Click:Connect(function() if setclipboard then setclipboard(url); Notify("Link Copied!") else Notify("No Copy Support :(") end end)
end

local function GetVal(obj, name)
    if obj:GetAttribute(name) ~= nil then return obj:GetAttribute(name) end
    if obj:FindFirstChild(name) then return obj[name].Value end
    return nil
end

local function IsValidTank(model)
    if not model:IsA("Model") then return false end
    if not model.PrimaryPart then return false end
    
    local owner = GetVal(model, "Owner")
    local alive = GetVal(model, "Alive")
    if owner == nil and model:FindFirstChild("Stats") then owner = GetVal(model.Stats, "Owner") end
    if alive == nil and model:FindFirstChild("Stats") then alive = GetVal(model.Stats, "Alive") end
    
    if owner and tostring(owner) ~= LocalPlayer.Name then
        if alive == true or alive == nil then return true end
    end
    return false
end

local function GetBestTargetPart(model)
    local bestPart = nil
    local bestPriority = 99
    
    local P1 = {"ammo", "rack", "projectile", "ready"}
    local P2 = {"fuel", "gas", "engine", "transmission", "motor"}
    
    for _, part in pairs(model:GetDescendants()) do
        if part:IsA("BasePart") then
            local n = part.Name:lower()
            local p = part.Parent.Name:lower()
            
            for _, k in pairs(P1) do 
                if n:find(k) or p:find(k) then return part, "Ammo" end 
            end
            
            for _, k in pairs(P2) do 
                if n:find(k) or p:find(k) then 
                    if bestPriority > 2 then bestPart = part; bestPriority = 2 end 
                end 
            end
        end
    end
    
    if bestPart then return bestPart, "Engine" end
    local turret = model:FindFirstChild("Turret", true)
    if turret then return turret, "Normal" end
    return model.PrimaryPart, "Normal"
end

local function GetClosestTargetForAim()
    local closestPart = nil
    local shortestDist = State.FOV
    local mouseLoc = UserInputService:GetMouseLocation()
    
    local targets = {}
    for _, v in pairs(Workspace:GetChildren()) do table.insert(targets, v) end
    if Workspace:FindFirstChild("Tanks") then for _, v in pairs(Workspace.Tanks:GetChildren()) do table.insert(targets, v) end end
    if Workspace:FindFirstChild("Vehicles") then for _, v in pairs(Workspace.Vehicles:GetChildren()) do table.insert(targets, v) end end

    for _, v in pairs(targets) do
        if IsValidTank(v) then
            local part, _ = GetBestTargetPart(v)
            if part then
                local pos, onScreen = Camera:WorldToViewportPoint(part.Position)
                local screenPos = Vector2.new(pos.X, pos.Y)
                local dist = (screenPos - mouseLoc).Magnitude
                
                if dist < shortestDist then
                    shortestDist = dist
                    closestPart = part
                end
            end
        end
    end
    return closestPart
end

CreateButton("Aimbot Active (RMB)", Page1, 10, 15, function(s, btn)
    State.Aimbot = s
    btn.Text = s and "Aiming: Active" or "Aimbot Active (RMB)"
end)

CreateButton("Mode: Smart Lock", Page1, 185, 15, function(s, btn)
    Notify("Always Smart Mode")
end)

local FOVCircle = Drawing.new("Circle")
FOVCircle.Color = Theme.Accent; FOVCircle.Thickness = 1.5; FOVCircle.NumSides = 60; FOVCircle.Radius = State.FOV; FOVCircle.Visible = false; FOVCircle.Filled = false
CreateButton("Show FOV", Page1, 10, 60, function(s, btn) FOVCircle.Visible = s end)

RunService:BindToRenderStep("QUWY_AIM_LOCK", 2000, function()
    local mouseLoc = UserInputService:GetMouseLocation()
    FOVCircle.Position = mouseLoc
    FOVCircle.Radius = State.FOV
    
    if not State.Aimbot then 
        if FOVCircle.Visible then FOVCircle.Color = Theme.Accent end
        return 
    end

    local target = GetClosestTargetForAim()
    
    if UserInputService:IsMouseButtonPressed(Enum.UserInputType.MouseButton2) then
        if target then
            FOVCircle.Color = Theme.Locked
            local camPos = Camera.CFrame.Position
            local targetPos = target.Position + State.Offset
            local desiredLook = CFrame.lookAt(camPos, targetPos)
            Camera.CFrame = Camera.CFrame:Lerp(desiredLook, State.Smoothness)
        else
            FOVCircle.Color = Theme.Accent
        end
    else
        if target then FOVCircle.Color = Theme.Green else FOVCircle.Color = Theme.Accent end
    end
end)

local EspContainer = Instance.new("Folder", CoreGui); EspContainer.Name = "QUWY_ESP_CONTAINER"

CreateButton("Tank Highlight", Page2, 10, 15, function(s, btn)
    State.ESP_Tanks = s
    if not s then EspContainer:ClearAllChildren() end
end)

CreateButton("Weak Spot Dots", Page2, 185, 15, function(s, btn)
    State.ESP_WeakSpots = s
    if not s then 
        for _, v in pairs(EspContainer:GetChildren()) do if v.Name:find("Dot") then v:Destroy() end end
    end
end)

task.spawn(function()
    while true do
        if not State.ESP_Tanks and not State.ESP_WeakSpots then 
            EspContainer:ClearAllChildren()
            wait(1)
        else
            local targets = {}
            for _, v in pairs(Workspace:GetChildren()) do table.insert(targets, v) end
            if Workspace:FindFirstChild("Tanks") then for _, v in pairs(Workspace.Tanks:GetChildren()) do table.insert(targets, v) end end
            
            for _, child in pairs(EspContainer:GetChildren()) do
                if not child.Adornee or not child.Adornee.Parent then child:Destroy() end
            end

            for _, v in pairs(targets) do
                if IsValidTank(v) then
                    if State.ESP_Tanks then
                        local hName = "H_"..v:GetDebugId()
                        if not EspContainer:FindFirstChild(hName) then
                            local h = Instance.new("Highlight")
                            h.Name = hName; h.Adornee = v; h.FillColor = Theme.Red; h.OutlineColor = Theme.Text; h.FillTransparency = 0.8; h.OutlineTransparency = 0.5; h.Parent = EspContainer
                        end
                    end
                    
                    if State.ESP_WeakSpots then
                        local part, type = GetBestTargetPart(v)
                        if part then
                            local dotName = "Dot_"..v:GetDebugId()
                            if not EspContainer:FindFirstChild(dotName) then
                                local color = Theme.Engine
                                if type == "Ammo" then color = Theme.Ammo end
                                local b = Instance.new("BoxHandleAdornment")
                                b.Name = dotName; b.Adornee = part; b.AlwaysOnTop = true; b.ZIndex = 10; b.Size = part.Size + Vector3.new(0.5, 0.5, 0.5); b.Color3 = color; b.Transparency = 0.3; b.Parent = EspContainer
                            else
                                local existing = EspContainer[dotName]
                                if existing.Adornee ~= part then existing.Adornee = part end
                            end
                        end
                    end
                end
            end
            wait(0.1)
        end
    end
end)

local AboutTitle = Instance.new("TextLabel", Page3)
AboutTitle.BackgroundTransparency = 1; AboutTitle.Size = UDim2.new(1, 0, 0.3, 0); AboutTitle.Position = UDim2.new(0, 0, 0.1, 0)
AboutTitle.Font = Enum.Font.FredokaOne; AboutTitle.Text = "QUWY"; AboutTitle.TextColor3 = Theme.Accent; AboutTitle.TextSize = 50
local SubTitle = Instance.new("TextLabel", Page3)
SubTitle.BackgroundTransparency = 1; SubTitle.Position = UDim2.new(0, 0, 0.4, 0); SubTitle.Size = UDim2.new(1, 0, 0, 20)
SubTitle.Font = Enum.Font.Gotham; SubTitle.Text = "Steel Titans Edition"; SubTitle.TextColor3 = Theme.SubText; SubTitle.TextSize = 14
CreateLinkBtn("Telegram: QLogovo", "https://t.me/QLogovo", 0)
CreateLinkBtn("Discord Server", "https://discord.gg/9wCEUewSbN", 45)

local Circle = Instance.new("TextButton"); Circle.Parent = ScreenGui; Circle.BackgroundColor3 = Theme.Background; Circle.Size = UDim2.new(0, 45, 0, 45); Circle.Position = UDim2.new(0.05, 0, 0.1, 0)
Circle.Text = "Q"; Circle.Font = Enum.Font.GothamBold; Circle.TextColor3 = Theme.Accent; Circle.TextSize = 22; Circle.Visible = false; Circle.AutoButtonColor = true
local CC = Instance.new("UICorner", Circle); CC.CornerRadius = UDim.new(1, 0); local CS = Instance.new("UIStroke", Circle); CS.Color = Theme.Accent; CS.Thickness = 1.5; CS.ApplyStrokeMode = Enum.ApplyStrokeMode.Border

local function MakeDrag(frame, handle)
    local dragging, dragStart, startPos
    handle.InputBegan:Connect(function(input) if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = true; dragStart = input.Position; startPos = frame.Position end end)
    handle.InputEnded:Connect(function(input) if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end end)
    UserInputService.InputChanged:Connect(function(input) if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then local delta = input.Position - dragStart; TweenService:Create(frame, TweenInfo.new(0.05), {Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)}):Play() end end)
end
MakeDrag(Main, TopBar)

local CircleDragged = false
local function CircleDragLogic()
    local dragging, dragStart, startPos
    Circle.InputBegan:Connect(function(input) if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = true; dragStart = input.Position; startPos = Circle.Position; CircleDragged = false end end)
    Circle.InputEnded:Connect(function(input) if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end end)
    UserInputService.InputChanged:Connect(function(input) if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then local delta = input.Position - dragStart; if delta.Magnitude > 3 then CircleDragged = true; TweenService:Create(Circle, TweenInfo.new(0.05), {Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)}):Play() end end end)
end
CircleDragLogic()

CloseBtn.MouseButton1Click:Connect(function() ScreenGui:Destroy() end)
MinBtn.MouseButton1Click:Connect(function() Main.Visible = false; Circle.Visible = true; Circle.Size = UDim2.new(0,0,0,0); TweenService:Create(Circle, TweenInfo.new(0.4, Enum.EasingStyle.Back), {Size = UDim2.new(0,45,0,45)}):Play() end)
Circle.MouseButton1Click:Connect(function() if not CircleDragged then Circle.Visible = false; Main.Visible = true; Main.Size = UDim2.new(0,0,0,0); TweenService:Create(Main, TweenInfo.new(0.4, Enum.EasingStyle.Back), {Size = UDim2.new(0, 480, 0, 320)}):Play() end end)

Main.Size = UDim2.new(0,0,0,0); TweenService:Create(Main, TweenInfo.new(0.5, Enum.EasingStyle.Quint), {Size = UDim2.new(0, 480, 0, 320)}):Play()
Notify("QUWY Loaded")
